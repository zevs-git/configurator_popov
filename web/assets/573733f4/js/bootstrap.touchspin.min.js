(function(e){e.fn.TouchSpin=function(t){var n={min:0,max:100,initval:"",step:1,decimals:0,stepinterval:100,forcestepdivisibility:"round",stepintervaldelay:500,prefix:"",postfix:"",prefix_extraclass:"",postfix_extraclass:"",booster:true,boostat:10,maxboostedstep:false,mousewheel:true,buttondown:'<button class="btn btn-default bootstrap-touchspin-down" type="button">-</button>',buttonup:'<button class="btn btn-default bootstrap-touchspin-up" type="button">+</button>'};return this.each(function(){function g(){if(i.data("alreadyinitialized")){return}i.data("alreadyinitialized",true);if(!i.is("input")){console.log("Must be an input.");return}E();y();M();x();C();k();L();A();u.input.css("display","block")}function y(){if(r.initval!==""&&i.val()===""){i.val(r.initval)}}function w(e){S(e);M();var t=Number(u.input.val());u.input.val(t.toFixed(r.decimals))}function E(){r=e.extend({},n,s,t)}function S(t){r=e.extend({},r,t)}function x(){var e=i.val(),t=i.parent();if(e!==""){e=Number(e).toFixed(r.decimals)}i.data("initvalue",e).val(e);i.addClass("form-control");if(t.hasClass("input-group")){T(t)}else{N()}}function T(t){t.addClass("bootstrap-touchspin");var n=i.prev(),s=i.next();var u,f,l='<span class="input-group-addon bootstrap-touchspin-prefix">'+r.prefix+"</span>",c='<span class="input-group-addon bootstrap-touchspin-postfix">'+r.postfix+"</span>";if(n.hasClass("input-group-btn")){u=r.buttondown,n.append(u)}else{u='<span class="input-group-btn">'+r.buttondown+"</span>";e(u).insertBefore(i)}if(s.hasClass("input-group-btn")){f=r.buttonup,s.prepend(f)}else{f=r.buttonup,f='<span class="input-group-btn">'+r.buttonup+"</span>";e(f).insertAfter(i)}e(l).insertBefore(i);e(c).insertAfter(i);o=t}function N(){var t='<div class="input-group bootstrap-touchspin"><span class="input-group-btn">'+r.buttondown+'</span><span class="input-group-addon bootstrap-touchspin-prefix">'+r.prefix+'</span><span class="input-group-addon bootstrap-touchspin-postfix">'+r.postfix+'</span><span class="input-group-btn">'+r.buttonup+"</span></div>";o=e(t).insertBefore(i);e(".bootstrap-touchspin-prefix",o).after(i);if(i.hasClass("input-sm")){o.addClass("input-group-sm")}else{if(i.hasClass("input-lg")){o.addClass("input-group-lg")}}}function C(){u={down:e(".bootstrap-touchspin-down",o),up:e(".bootstrap-touchspin-up",o),input:e("input",o),prefix:e(".bootstrap-touchspin-prefix",o).addClass(r.prefix_extraclass),postfix:e(".bootstrap-touchspin-postfix",o).addClass(r.postfix_extraclass)}}function k(){if(r.prefix==""){u.prefix.hide()}if(r.postfix==""){u.postfix.hide()}}function L(){i.on("keydown",function(e){var t=e.keyCode||e.which;if(t===38){if(m!=="up"){D();B()}e.preventDefault()}else{if(t===40){if(m!=="down"){P();H()}e.preventDefault()}}});i.on("keyup",function(e){var t=e.keyCode||e.which;if(t===38){j()}else{if(t===40){j()}}});i.on("blur",function(){M()});u.down.on("keydown",function(e){var t=e.keyCode||e.which;if(t===32||t===13){if(m!=="down"){P();H()}e.preventDefault()}});u.down.on("keyup",function(e){var t=e.keyCode||e.which;if(t===32||t===13){j()}});u.up.on("keydown",function(e){var t=e.keyCode||e.which;if(t===32||t===13){if(m!=="up"){D();B()}e.preventDefault()}});u.up.on("keyup",function(e){var t=e.keyCode||e.which;if(t===32||t===13){j()}});u.down.on("mousedown touchstart",function(e){P();H();e.preventDefault();e.stopPropagation()});u.up.on("mousedown touchstart",function(e){D();B();e.preventDefault();e.stopPropagation()});u.up.on("mouseout touchleave touchend touchcancel",function(e){if(!m){return}e.stopPropagation();j()});u.down.on("mouseout touchleave touchend touchcancel",function(e){if(!m){return}e.stopPropagation();j()});u.down.on("mousemove touchmove",function(e){if(!m){return}e.stopPropagation();e.preventDefault()});u.up.on("mousemove touchmove",function(e){if(!m){return}e.stopPropagation();e.preventDefault()});e(document).on("mouseup touchend touchcancel",function(e){if(!m){return}e.preventDefault();j()});e(document).on("mousemove touchmove scroll scrollstart",function(e){if(!m){return}e.preventDefault();j()});if(r.mousewheel){i.on("mousewheel DOMMouseScroll",function(e){var t=e.originalEvent.wheelDelta||-e.originalEvent.detail;e.stopPropagation();e.preventDefault();if(t<0){P()}else{D()}})}}function A(){i.on("touchspin.uponce",function(){j();D()});i.on("touchspin.downonce",function(){j();P()});i.on("touchspin.startupspin",function(e){B()});i.on("touchspin.startdownspin",function(){H()});i.on("touchspin.stopspin",function(){j()});i.on("touchspin.updatesettings",function(e,t){w(t)})}function O(e){switch(r.forcestepdivisibility){case"round":return(Math.round(e/r.step)*r.step).toFixed(r.decimals);break;case"floor":return(Math.floor(e/r.step)*r.step).toFixed(r.decimals);break;case"ceil":return(Math.ceil(e/r.step)*r.step).toFixed(r.decimals);break;default:return e}}function M(){var e,t,n;e=i.val();if(e===""){return}if(r.decimals>0&&e==="."){return}t=parseFloat(e);if(isNaN(t)){t=0}n=t;if(t.toString()!==e){n=t}if(t<r.min){n=r.min}if(t>r.max){n=r.max}n=O(n);if(Number(e).toString()!==n.toString()){i.val(n);i.trigger("change")}}function _(){if(!r.booster){return r.step}else{var e=Math.pow(2,Math.floor(v/r.boostat))*r.step;if(r.maxboostedstep){if(e>r.maxboostedstep){e=r.maxboostedstep;f=Math.round(f/e*e)}}return Math.max(r.step,e)}}function D(){M();f=parseFloat(u.input.val());if(isNaN(f)){f=0}var e=f,t=_();f=f+t;if(f>r.max){f=r.max;i.trigger("touchspin.on.max");j()}u.input.val(Number(f).toFixed(r.decimals));if(e!==f){i.trigger("change")}}function P(){M();f=parseFloat(u.input.val());if(isNaN(f)){f=0}var e=f,t=_();f=f-t;if(f<r.min){f=r.min;i.trigger("touchspin.on.min");j()}u.input.val(f.toFixed(r.decimals));if(e!==f){i.trigger("change")}}function H(){j();v=0;m="down";i.trigger("touchspin.on.startspin");i.trigger("touchspin.on.startdownspin");p=setTimeout(function(){l=setInterval(function(){v++;P()},r.stepinterval)},r.stepintervaldelay)}function B(){j();v=0;m="up";i.trigger("touchspin.on.startspin");i.trigger("touchspin.on.startupspin");d=setTimeout(function(){h=setInterval(function(){v++;D()},r.stepinterval)},r.stepintervaldelay)}function j(){clearTimeout(p);clearTimeout(d);clearInterval(l);clearInterval(h);switch(m){case"up":i.trigger("touchspin.on.stopupspin");i.trigger("touchspin.on.stopspin");break;case"down":i.trigger("touchspin.on.stopdownspin");i.trigger("touchspin.on.stopspin");break}v=0;m=false}var r,i=e(this),s=i.data(),o,u,f,l,h,p,d,v=0,m=false;g()})}})(jQuery)